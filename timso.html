<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ä†·àµ·â≥·ãã·àΩ</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #001a00; color: #d4af37; padding: 20px; }
        h1 { color: #d4af37; text-shadow: 2px 2px #000; }
        .card { background: #002b00; padding: 15px; margin: 10px auto; border-radius: 15px; max-width: 350px; border: 1px solid #d4af37; }
        input[type="time"] { background: #000; color: #d4af37; border: 1px solid #d4af37; padding: 10px; border-radius: 5px; width: 80%; }
        .start-btn { background: #d4af37; color: #000; padding: 15px; border-radius: 30px; width: 100%; max-width: 350px; font-weight: bold; margin-top: 20px; }
        .fajr { color: #fff; } .zuhur { color: #4caf50; } .asr { color: #ff9800; } .magrib { color: #f44336; } .isha { color: #2196f3; } .suhur { color: #e91e63; }
    </style>
</head>
<body>
    <h1>·ä†·àµ·â≥·ãã·àΩ</h1>
    <div id="prayer-list"></div>
    <button class="start-btn" onclick="startReminder()">·ä†·àµ·â≥·ãã·àπ·äï ·ä†·àµ·åÄ·àù·à≠</button>
    <p id="status"></p>

    <script>
        const prayers = [
            {id: "·çà·åÖ·à≠", class: "fajr"}, {id: "·ãù·àÅ·à≠", class: "zuhur"}, 
            {id: "·ãì·àµ·à≠", class: "asr"}, {id: "·àò·åç·à™·â•", class: "magrib"}, 
            {id: "·ä¢·àª·ä•", class: "isha"}, {id: "·àµ·àÅ·à≠", class: "suhur"}
        ];
        let prayerData = {};

        // ·ãµ·àù·çÖ·äï ·â†·âã·àö·äê·âµ ·àµ·àç·ä≠ ·ãç·àµ·å• ·àà·àò·âÖ·â†·à≠ ·ã®·àö·à®·ã≥ Database (IndexedDB)
        const dbRequest = indexedDB.open("PrayerDB", 1);
        dbRequest.onupgradeneeded = e => e.target.result.createObjectStore("sounds");

        window.onload = () => {
            const list = document.getElementById('prayer-list');
            prayers.forEach(p => {
                const savedTime = localStorage.getItem(p.id) || "";
                prayerData[p.id] = { time: savedTime, audio: null };

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<h3 class="${p.class}">${p.id}</h3>
                    <input type="time" value="${savedTime}" onchange="saveTime('${p.id}', this.value)">
                    <input type="file" accept="audio/*" onchange="handleFile(event, '${p.id}')">`;
                list.appendChild(div);

                // ·ã®·â∞·âÄ·àò·å† ·ãµ·àù·çÖ ·ä´·àà ·ä†·ãç·å£
                dbRequest.onsuccess = () => {
                    const tx = dbRequest.result.transaction("sounds", "readonly");
                    const store = tx.objectStore("sounds");
                    const getReq = store.get(p.id);
                    getReq.onsuccess = () => {
                        if (getReq.result) prayerData[p.id].audio = new Audio(getReq.result);
                    };
                };
            });
        };

        function saveTime(id, val) {
            prayerData[id].time = val;
            localStorage.setItem(id, val);
        }

        function handleFile(e, id) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = ev => {
                const blob = ev.target.result;
                prayerData[id].audio = new Audio(blob);
                const tx = dbRequest.result.transaction("sounds", "readwrite");
                tx.objectStore("sounds").put(blob, id); // ·ãµ·àù·çÅ·äï ·àµ·àç·ä≠ ·ãç·àµ·å• ·âÄ·â†·à®·ãç!
            };
            reader.readAsDataURL(file);
        }

        function startReminder() {
            document.getElementById('status').innerText = "·â∞·åÄ·àù·àØ·àç! üåô (·ä†·çë·äï Background ·àã·ã≠ ·ä†·âµ·ãù·åã·ãç)";
            setInterval(() => {
                const now = new Date();
                const nowTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
                for (let id in prayerData) {
                    if (prayerData[id].time === nowTime && prayerData[id].audio) {
                        prayerData[id].audio.play();
                        alert(id + " ·à∞·ãì·âµ ·ã∞·à≠·à∑·àç!");
                    }
                }
            }, 1000);
        }
    </script>
</body>
</html>

