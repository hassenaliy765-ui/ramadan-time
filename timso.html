<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ä†·àµ·â≥·ãã·àΩ - ·à®·àò·ã∑·äï ·àô·â£·à®·ä≠</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            background-color: #001a00; /* ·å•·âÅ·à≠ ·ä†·à®·äï·åì·ã¥ */
            color: #d4af37; /* ·ãà·à≠·âÉ·àõ */
            padding: 20px;
        }
        h1 { font-size: 3rem; margin-bottom: 5px; text-shadow: 2px 2px #000; }
        .card { 
            background: #002b00; 
            padding: 15px; 
            margin: 15px auto; 
            border-radius: 15px; 
            max-width: 380px; 
            border: 1px solid #d4af37;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .fajr { color: #fff; } .zuhur { color: #4caf50; } .asr { color: #ff9800; } 
        .magrib { color: #f44336; } .isha { color: #2196f3; } .suhur { color: #e91e63; }
        
        input[type="time"] { 
            background: #000; color: #d4af37; border: 1px solid #d4af37; 
            padding: 10px; border-radius: 8px; width: 85%; font-size: 18px; margin: 10px 0;
        }
        input[type="file"] { color: #fff; font-size: 12px; margin-top: 5px; }
        .start-btn { 
            background: linear-gradient(45deg, #d4af37, #aa891a); 
            color: #000; padding: 18px; border: none; border-radius: 50px; 
            font-size: 1.3rem; font-weight: bold; width: 100%; max-width: 380px; 
            cursor: pointer; margin-top: 20px;
        }
        #status { color: #00ff00; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>·ä†·àµ·â≥·ãã·àΩ</h1>
    <div style="color: #fff; margin-bottom: 20px;">·ã®·à®·àò·ã∑·äï ·ã®·à∂·àã·âµ·äì ·àµ·àÅ·à≠ ·ä†·àµ·â≥·ãã·àΩ</div>

    <div id="prayer-list"></div>
    <div id="status"></div>
    <button class="start-btn" onclick="startReminder()">·ä†·àµ·â≥·ãã·àπ·äï ·ä†·àµ·åÄ·àù·à≠</button>

    <script>
        const prayers = [
            {id: "·çà·åÖ·à≠", class: "fajr"}, {id: "·ãù·àÅ·à≠", class: "zuhur"}, 
            {id: "·ãì·àµ·à≠", class: "asr"}, {id: "·àò·åç·à™·â•", class: "magrib"}, 
            {id: "·ä¢·àª·ä•", class: "isha"}, {id: "·àµ·àÅ·à≠", class: "suhur"}
        ];
        let prayerData = {};

        // 1. ·ãµ·àù·çÖ·äï ·â†·âã·àö·äê·âµ ·àµ·àç·ä≠ ·ãç·àµ·å• ·àà·àò·âÖ·â†·à≠ Database ·àò·ä≠·çà·âµ
        const dbRequest = indexedDB.open("PrayerAudioDB", 1);
        dbRequest.onupgradeneeded = e => e.target.result.createObjectStore("sounds");

        window.onload = () => {
            const list = document.getElementById('prayer-list');
            prayers.forEach(p => {
                const savedTime = localStorage.getItem(p.id) || "";
                prayerData[p.id] = { time: savedTime, audio: null, playedToday: false };

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<h3 class="${p.class}">${p.id}</h3>
                    <input type="time" value="${savedTime}" onchange="saveTime('${p.id}', this.value)">
                    <input type="file" accept="audio/*" onchange="storeAudio(event, '${p.id}')">`;
                list.appendChild(div);

                // ·àµ·àç·ä≠ ·ãç·àµ·å• ·ã®·â∞·âÄ·àò·å† ·ãµ·àù·çÖ ·ä´·àà ·ä†·ãç·å£
                dbRequest.onsuccess = () => {
                    const tx = dbRequest.result.transaction("sounds", "readonly");
                    const store = tx.objectStore("sounds");
                    const getReq = store.get(p.id);
                    getReq.onsuccess = () => {
                        if (getReq.result) {
                            prayerData[p.id].audio = new Audio(getReq.result);
                        }
                    };
                };
            });
        };

        function saveTime(id, val) {
            prayerData[id].time = val;
            prayerData[id].playedToday = false; // ·à∞·ãì·âµ ·à≤·âÄ·ã®·à≠ ·ãµ·åã·àö ·ä•·äï·ã≤·åÆ·àÖ ·ã≠·çà·âÖ·ã≥·àç
            localStorage.setItem(id, val);
        }

        function storeAudio(e, id) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = ev => {
                const blob = ev.target.result;
                prayerData[id].audio = new Audio(blob);
                // ·ãµ·àù·çÅ·äï ·â†·âã·àö·äê·âµ ·àµ·àç·ä© Database ·ãç·àµ·å• ·àõ·àµ·âÄ·àò·å•
                const tx = dbRequest.result.transaction("sounds", "readwrite");
                tx.objectStore("sounds").put(blob, id);
            };
            reader.readAsDataURL(file);
        }

        function startReminder() {
            document.getElementById('status').innerText = "·ä†·àµ·â≥·ãã·àπ ·â†·âµ·ä≠·ä≠·àç ·â∞·åÄ·àù·àØ·àç! üåô";
            
            // ·â†·ã®·ã∞·âÇ·âÉ·ãç ·ä†·äï·ãµ ·åä·ãú ·â•·âª ·âº·ä≠ ·ã´·ã∞·à≠·åã·àç
            setInterval(() => {
                const now = new Date();
                const nowTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
                
                for (let id in prayerData) {
                    if (prayerData[id].time === nowTime && !prayerData[id].playedToday) {
                        if (prayerData[id].audio) {
                            prayerData[id].audio.play();
                            prayerData[id].playedToday = true; // ·àà·ä†·äï·ãµ ·ã∞·âÇ·âÉ ·â•·âª ·ä•·äï·ã≤·åÆ·àÖ
                            alert(id + " ·à∞·ãì·âµ ·ã∞·à≠·à∑·àç!");
                            // ·àà·àö·âÄ·å•·àà·ãç ·ã∞·âÇ·âÉ ·ãù·åç·åÅ ·ä•·äï·ã≤·àÜ·äï ·ä®60 ·à∞·ä®·äï·ãµ ·â†·äã·àã ·àò·àç·à∞·ãç
                            setTimeout(() => { prayerData[id].playedToday = false; }, 61000);
                        }
                    }
                }
            }, 1000);
        }
    </script>
</body>
</html>


